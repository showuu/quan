{"version":3,"sources":["observer.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["function defineReactive(obj, key, val, callback, options = {}) {\r\n  Object.defineProperty(obj, key, {\r\n    configurable: true,\r\n    emuerable: true,\r\n    get() {\r\n      return val;\r\n    },\r\n    set(newVal) {\r\n      console.log('set', newVal, val)\r\n      if (newVal === val) {\r\n        return;\r\n      }\r\n      const oldVal = val;\r\n      val = newVal;\r\n      callback && typeof callback === \"function\" && callback(newVal, oldVal);\r\n      options.deep && watch(obj, key, callback, options);\r\n    }\r\n  });\r\n}\r\n\r\nfunction watch(data, exp, callback, options = {}) {\r\n  const k = exp.split(\".\");\r\n  for (let i = 0; i < k.length - 1; i++) {\r\n    data = data[k[i]]; // 键路径最深一层所属的对象\r\n  }\r\n  const key = k[k.length - 1];\r\n  let val = data[key];\r\n  if (options.deep && typeof val === \"object\") {\r\n    Object.keys(val).forEach(childKey => {\r\n      watch(val, childKey, callback, options);\r\n    });\r\n  }\r\n  defineReactive(data, key, val, callback, options);\r\n}\r\nfunction setObserver(ctx) {\r\n  if (!ctx) {\r\n    console.warn(\"未指定Page所在上下文环境\");\r\n    return;\r\n  }\r\n  if (!ctx.data) {\r\n    console.warn(\"Page缺少data对象\");\r\n    return;\r\n  }\r\n  if (!ctx.watch) {\r\n    console.warn(\"请在Page的watch对象中设置需要监听的属性\");\r\n    return;\r\n  }\r\n  // 为watch对象内的每一个属性表达式注册监听器\r\n  Object.keys(ctx.watch).forEach(exp => {\r\n    const callback = (ctx.watch[exp].handler || ctx.watch[exp]).bind(ctx);\r\n    const deep = ctx.watch[exp].deep;\r\n    const options = {\r\n      ...(deep && { deep })\r\n    };\r\n    watch(ctx.data, exp, callback, options);\r\n  });\r\n}\r\n\r\nif (!exports.__esModule) Object.defineProperty(exports, \"__esModule\", { value: true });Object.defineProperty(exports, 'setObserver', { enumerable: true, configurable: true, get: function() { return setObserver; } });Object.defineProperty(exports, 'watch', { enumerable: true, configurable: true, get: function() { return watch; } });\r\n"]}